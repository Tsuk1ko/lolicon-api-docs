# 随机色图

该 API 最初是作为 [cq-picsearcher-bot](https://github.com/Tsuk1ko/cq-picsearcher-bot) 的娱乐功能而被开发出来的，后经过一些调整决定正式开放使用

> 目前已将 API 迁移出我个人的服务器并转用某些白嫖服务，因此我将限制放开了，不再需要 apikey 并且一次允许返回的数量增加了，但这也意味着可能存在一些来自服务商的隐性限制
>
> 如果服务因超出限制而宕掉，我不对此负责，**请理性使用**

## 前言

1. 所有插画均来自 [Pixiv](https://www.pixiv.net/)，版权也归插画的作者所有，API 本身不提供插画的代理或储存服务
2. 为了保证质量，API 中的插画全是由本人凭着性趣亲手添加的，不存在自动爬取等敷衍的操作，所以大部分图片都只是符合我个人的 xp 或是我喜爱的画风，如果你不喜欢那真是抱歉了
3. 我的 xp 是什么？看看这域名还不明白吗（
4. 这些色图是广义上的色图——任何能让**我好了**的图都可能被我算作色图，所以你也许会觉得并不是所有的图都很色，这是正常的，你就当成是抽卡好了，没必要拿去和其它色图库比较  
   ![](assets/img/xkst.png)
5. 不接受任何索要数据库的请求（反正会有一堆人来爬的，去找他们要）
6. 使用 API 是你个人的行为，产生的任何问题都与我无关
7. 请**节制**![](assets/img/jz.png)，冲太多对身体不好
   ![](assets/img/lx.jpg)

## 最近一小时可用性

炸了就说明有憨批搁那拿爬虫CC

<iframe src="availability.html" height="200" scrolling="no" style="border:none;margin:0"></iframe>

## Telegram Bot

[@setu_robot](https://t.me/setu_robot)，仅支持 inline 方式调用

## API v2

```
GET https://api.lolicon.app/setu/v2
```

或

```
POST https://api.lolicon.app/setu/v2
Content-Type: application/json
```

### 请求

| 参数名       |  数据类型  |     默认值     | 说明                                                                                                                         |
| ------------ | :--------: | :------------: | ---------------------------------------------------------------------------------------------------------------------------- |
| `r18`        |   `int`    |      `0`       | `0`为非 R18，`1`为 R18，`2`为混合（在库中的分类，不等同于作品本身的 R18 标识）                                               |
| `num`        |   `int`    |      `1`       | 一次返回的结果数量，范围为`1`到`100`；在指定关键字或标签的情况下，结果数量可能会不足指定的数量                               |
| `uid`        |  `int[]`   |                | 返回指定`uid`的作品，最多`20`个                                                                                              |
| `keyword`    |  `string`  |                | 返回从标题、作者、标签中按指定关键字模糊搜索的结果                                                                           |
| `tag`        | `string[]` |                | 返回同时含有所有指定标签的作品，最多`3`个；仅按这两种方式匹配：(1)完全匹配 (2)`角色名(出处)`形式的标签中匹配`角色名`或`出处` |
| `size`       | `string[]` | `["original"]` | 返回指定图片规格的地址，可选`original`,`regular`,`small`,`thumb`,`mini`                                                      |
| `proxy`      |  `string`  | `i.pixiv.cat`  | 设置图片地址所使用的在线反代服务，你也可以设置为任何假值(`""`,`false`,`null`)来得到原始的图片地址                            |
| `dateAfter`  |  `number`  |                | 返回在这个时间及以后上传的作品；时间戳，单位为毫秒                                                                           |
| `dateBefore` |  `number`  |                | 返回在这个时间及以前上传的作品；时间戳，单位为毫秒                                                                           |
| `dsc`        | `boolean`  |    `false`     | 设置为任何真值以禁用对某些缩写`keyword`和`tag`的自动转换                                                                     |

#### 发送数组参数

GET 请求可以通过追加同名参数来发送数组，例如

```
GET https://api.lolicon.app/setu/v2?size=original&size=regular
```

#### 关于 `size`

以下为五种规格的示例（SFW，请放心打开）

| 规格     | 地址                                                                                              |
| -------- | ------------------------------------------------------------------------------------------------- |
| original | https://i.pixiv.cat/img-original/img/2021/06/14/17/25/59/90551655_p0.jpg                          |
| regular  | https://i.pixiv.cat/img-master/img/2021/06/14/17/25/59/90551655_p0_master1200.jpg                 |
| small    | https://i.pixiv.cat/c/540x540_70/img-master/img/2021/06/14/17/25/59/90551655_p0_master1200.jpg    |
| thumb    | https://i.pixiv.cat/c/250x250_80_a2/img-master/img/2021/06/14/17/25/59/90551655_p0_square1200.jpg |
| mini     | https://i.pixiv.cat/c/48x48/img-master/img/2021/06/14/17/25/59/90551655_p0_square1200.jpg         |

#### 关于`proxy`

由于P站资源域名`i.pximg.net`具有防盗链措施，不含`www.pixiv.net` referer 的请求均会 403，所以如果需要直接在网页上展示或在客户端上直接下载必须依靠反代服务

1. 当不指定协议时，会自动补充`https://`
1. 可使用以下占位符
| 占位符     | 说明               |
| ---------- | ------------------ |
| `{{pid}}`  | 作品 pid           |
| `{{p}}`    | 作品所在页         |
| `{{uid}}`  | 作者 uid           |
| `{{ext}}`  | 图片扩展名         |
| `{{path}}` | 图片地址的相对路径 |

例：以下四种是等价的

```
i.pixiv.cat
https://i.pixiv.cat
i.pixiv.cat/{{path}}
https://i.pixiv.cat/{{path}}
```

### 响应

| 字段名  | 数据类型 | 说明     |
| ------- | :------: | -------- |
| `error` | `string` | 错误信息 |
| `data`  | `setu[]` | 色图数组 |

#### `setu`

| 字段名       |  数据类型  | 说明                                                  |
| ------------ | :--------: | ----------------------------------------------------- |
| `pid`        |   `int`    | 作品 pid                                              |
| `p`          |   `int`    | 作品所在页                                            |
| `uid`        |   `int`    | 作者 uid                                              |
| `title`      |  `string`  | 作品标题                                              |
| `author`     |  `string`  | 作者名（入库时，并过滤掉 @ 及其后内容）               |
| `r18`        | `boolean`  | 是否 R18（在库中的分类，不等同于作品本身的 R18 标识） |
| `width`      |   `int`    | 原图宽度 px                                           |
| `height`     |   `int`    | 原图高度 px                                           |
| `tags`       | `string[]` | 作品标签，包含标签的中文翻译（有的话）                |
| `ext`        |  `string`  | 图片扩展名                                            |
| `uploadDate` |  `number`  | 作品上传日期；时间戳，单位为毫秒                      |
| `urls`       |  `object`  | 包含了所有指定的`size`的图片地址                      |

## 其它细节

- **自动更新插画信息**  
  被获取的色图如果距离上次更新信息超过一个月，则会被加入更新队列在后台进行信息更新，以防止插画修改或删除造成的原图地址时效。但当次调用以及直到信息更新完毕前，从 API 获取到的信息仍会是旧的信息。

## 旧版 API 文档

- [v1](setu-v1)

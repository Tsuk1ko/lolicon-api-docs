# 随机色图

该 API 最初是作为 [cq-picsearcher-bot](https://github.com/Tsuk1ko/cq-picsearcher-bot) 的娱乐功能而被开发出来的，后经过一些调整决定正式开放使用

## 前言

1. 所有插画均来自 [Pixiv](https://www.pixiv.net/)，版权也归插画的作者所有，API 本身不提供插画的代理或储存服务
2. 为了保证质量，API 中的插画全是由本人凭着性趣亲手添加的，不存在自动爬取等敷衍的操作，所以大部分图片都只是符合我个人的 xp 或是我喜爱的画风，如果你不喜欢那真是抱歉了
3. 我的 xp 是什么？看看这域名还不明白吗（
4. 这些色图是广义上的色图——任何能让**我好了**的图都可能被我算作色图，所以你也许会觉得并不是所有的图都很色，这是正常的，你就当成是抽卡好了，没必要拿去和其它色图库比较  
   ![](assets/img/xkst.png)
5. 不接受任何索要数据库的请求（反正会有一堆人来爬的，去找他们要）
6. 使用 API 是你个人的行为，产生的任何问题都与我无关
7. 请**节制**![](assets/img/jz.png)，冲太多对身体不好
   ![](assets/img/lx.jpg)

## 现状

目前已将 API 迁移出我个人的服务器并转用某些白嫖服务，因此我将限制放开了，不再需要申请 apikey 并且一次允许返回的数量增加了，但这也意味着可能存在一些来自服务商的隐性限制。

如果服务因超出限制而宕掉，我不对此负责，**请理性使用**。

API v2 正计划开发中，将会提供更丰富的搜索和筛选功能。

## 最近一小时可用性

炸了就说明有憨批搁那拿爬虫CC

<iframe src="availability.html" height="200" scrolling="no" style="border:none;margin:0"></iframe>

## Telegram Bot

[@setu_robot](https://t.me/setu_robot)，仅支持 inline 方式调用

## API

GET `https://api.lolicon.app/setu/v1`

### 请求

| 字段名     | 必须  |    默认值     | 说明                                                                                                                                                                    |
| ---------- | :---: | :-----------: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `r18`      | false |      `0`      | `0`为非 R18，`1`为 R18，`2`为混合                                                                                                                                       |
| `keyword`  | false |               | 若指定关键字，将会返回从插画标题、作者、标签中模糊搜索的结果，遵循 [mongoDB $search 语法](https://docs.mongodb.com/manual/reference/operator/query/text/#-search-field) |
| `num`      | false |      `1`      | 一次返回的结果数量，范围为`1`到`100`；在指定关键字的情况下，结果数量可能会不足指定的数量                                                                                |
| `proxy`    | false | `i.pixiv.cat` | 设置返回的原图链接的域名，你也可以设置为`disable`来得到真正的原图链接<span class="notice"><sup>[1]</sup></span>                                                         |
| `size1200` | false |    `false`    | 是否使用 master_1200 缩略图，即长或宽最大为 1200px 的缩略图，以节省流量或提升加载速度（某些原图的大小可以达到十几MB）                                                   |

<span class="notice">[1]</span> 由于P站原图域名 `i.pximg.net` 具有防盗链措施，不含 `www.pixiv.net` referer 的请求均会返回 403，所以如果需要直接在网页上展示或在客户端上直接下载必须依靠反代服务。

### 响应

| 字段名  | 数据类型 | 说明                       |
| ------- | :------: | -------------------------- |
| `code`  |   int    | 返回码，可能值详见后续部分 |
| `msg`   |  string  | 错误信息之类的             |
| `count` |   int    | 结果数                     |
| `data`  | setu []  | 色图数组                   |

#### setu

| 字段名   | 数据类型  | 说明                                                      |
| -------- | :-------: | --------------------------------------------------------- |
| `pid`    |    int    | 作品 PID                                                  |
| `p`      |    int    | 作品所在 P                                                |
| `uid`    |    int    | 作者 UID                                                  |
| `title`  |  string   | 作品标题                                                  |
| `author` |  string   | 作者名（入库时，并过滤掉 @ 及其后内容）                   |
| `url`    |  string   | 图片链接（可能存在有些作品因修改或删除而导致 404 的情况） |
| `r18`    |  boolean  | 是否 R18（在色图库中的分类，并非作者标识的 R18）          |
| `width`  |    int    | 原图宽度 px                                               |
| `height` |    int    | 原图高度 px                                               |
| `tags`   | string [] | 作品标签，包含标签的中文翻译（有的话）                    |

#### code

| 值    | 说明                            |
| ----- | ------------------------------- |
| `-1`  | 内部错误，请向 i@loli.best 反馈 |
| `0`   | 成功                            |
| `404` | 找不到符合关键字的色图          |

## 其它细节

- **自动更新插画信息**  
  被获取的色图如果距离上次更新信息超过一个月，则会被加入更新队列在后台进行信息更新，以防止插画被修改或删除造成的原图地址时效。但当次调用以及直到信息更新完毕前，从 API 获取到的信息仍会是旧的信息。
